{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
    <div class="col-md-2 bg-dark text-white vh-100 p-3">
      <h4 class="text-center">Admin Panel</h4>
      <ul class="nav flex-column mt-4">
        <li class="nav-item"><a class="nav-link text-white" href="{{ url_for('dashboard') }}">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link text-white" href="{{ url_for('profile') }}">My Profile</a></li>
        <li class="nav-item"><a class="nav-link text-white" href="{{ url_for('logout') }}">Logout</a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="col-md-10">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <span class="navbar-text">Welcome, {{ name }} ðŸ‘‹</span>
          <button class="btn btn-sm btn-secondary ms-auto" id="darkModeToggle">Dark Mode</button>
        </div>
      </nav>

      <!-- Stats Cards -->
      <div class="row mt-4">
        <div class="col-md-4">
          <div class="card text-white bg-primary mb-3">
            <div class="card-body">
              <h5 class="card-title">Total Users</h5>
              <p class="card-text fs-3">{{ total_users }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-success mb-3">
            <div class="card-body">
              <h5 class="card-title">Admins</h5>
              <p class="card-text fs-3">{{ total_admins }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-warning mb-3">
            <div class="card-body">
              <h5 class="card-title">Regular Users</h5>
              <p class="card-text fs-3">{{ total_users - total_admins }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Table -->
      <div class="card shadow p-4 mt-4">
        <h4>Registered Users</h4>
        <div class="table-responsive mt-3">
          <table class="table table-striped table-bordered" id="usersTable">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for user in users %}
              <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>
                  <a href="{{ url_for('edit_user', user_id=user.id) }}" class="btn btn-sm btn-info">Edit</a>
                  <a href="{{ url_for('delete_user', user_id=user.id) }}" class="btn btn-sm btn-danger" 
                     onclick="return confirm('Are you sure you want to delete this user?');">Delete</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Optional Scripts -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script>
  $(document).ready(function() {
    $('#usersTable').DataTable(); // searchable, sortable table
  });

  // Dark Mode Toggle
  const toggle = document.getElementById('darkModeToggle');
  toggle.addEventListener('click', () => {
    document.body.classList.toggle('bg-dark');
    document.body.classList.toggle('text-white');
  });
</script>
{% endblock %}
